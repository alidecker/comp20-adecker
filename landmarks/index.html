<!doctype HTML >

<html>

  <head>
    <title>Landmark Locator</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
    <script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBvoCvuP_zoP_9Q0JNqB_dhjJsk-gVc-5s"></script>
    <link rel="stylesheet" href="landmarkstyle.css" type="text/css" />
    <script>
      var lat = 0;
      var long = 0;
      var myPos = new google.maps.LatLng(lat, long);
      var myOptions = {
	zoom: 13,
	center: myPos,
	mapTypeId: google.maps.MapTypeId.ROADMAP
      };
      var map;
      var marker;
      var infowindow = new google.maps.InfoWindow();
      var allLoc = {};

      function init() {
        map = new google.maps.Map(document.getElementById("mapBackground"), myOptions);
        getLocation();
      }

      function getLocation(){
        var xhr = new XMLHttpRequest();
        navigator.geolocation.getCurrentPosition(function(position) {
          lat = position.coords.latitude;
          long = position.coords.longitude;     
          xhr.open("POST", "https://defense-in-derpth.herokuapp.com/sendLocation", true);
          xhr.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
          xhr.onreadystatechange = function () {
            if (xhr.readyState == 4 && xhr.status == 200) {
              allLoc = JSON.parse(xhr.responseText);
              console.log(allLoc);
              renderMap();
            }
          };
          xhr.send("login=iJRFOmvB&lat="+lat+"&lng="+long);
        });
      }

      function renderMap(){
        for (i = 0; i < allLoc.people.length; i++) {
	  var currPos = new google.maps.LatLng(allLoc.people[i].lat, allLoc.people[i].lng);		
	  marker = new google.maps.Marker({
	    position: currPos,
	    icon: 'IMG_0065.jpg',
            title: allLoc.people[i]._id
	  });
	  marker.setMap(map);
	myPos = new google.maps.LatLng(lat, long);
	map.panTo(myPos);
	marker = new google.maps.Marker({
          position: myPos,
          icon: 'me-marker.jpg',
	  title: "Here I Am!"
	});
        marker.setMap(map);		
        }
      }
      
    </script>
  </head>

  <body onload="init()">
    <div id="mapBackground"></div>
  </body>
  
</html>
